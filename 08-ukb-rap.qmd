# UK Biobank Research Analysis Platform

## What's Different?

There are three main differences with UK Biobank and the Core DNAnexus Platform

1. You are limited to sharing within your own application ID.
2. The participant identifiers (`eid`s) are different across applications.
3. There is a `Bulk/` File Folder that contains many of the files you want to analyze.

## Application ID and Sharing

What is an application ID? 

![UKB Application Process](images/ukb_application.png)

## Psuedonymization and Participant IDs

Within an application, the participant IDs (also known as EIDs) are unique, through the pseudonymization process. This process has been done to ensure security and anonymity of participants. This means that you **cannot join data across applications**.

For example, if I'm in application ID 43333 and you're in application 11111, our EIDs will not correspond because we have unique EIDs. Our data files are also mapped to these unique IDs.

So if I make a pheno matrix with EIDs and you want to reuse this pheno matrix in your application, it won't work, because our EIDs don't match up. 

## Bulk Files

The other difference with UKB RAP is that a lot of the data (image, genomics, etc) are available as files that have been dispensed into your `Bulk/` folder. 

Here are a few examples of searching for bulk files. 

## Example Jobs on UKB


## Extracting Pheno Data from the RAP Dataset

This is a question we get a lot. I'll explain the current two best ways to extract the pheno data:

1. Use the Table Exporter App to export the phenotype fields to a CSV file. You have the option to select a decoded file when you run it. 
2. Use the dx-toolkit command `dx extract_dataset` to extract raw values to a CSV file, and decode the file manually.

The first thing you need to do is identify the dataset in your project. Make sure that you chose to dispense data in your project (see above), and the dataset should be in the root of your project and begin with `dataset-`. 

You'll want to grab the record ID for your dataset. You can find it by selecting your dataset in the GUI and clicking the "i" button in the top-left. 

## Extracting Raw Pheno Data using `dx extract_dataset`

If you don't want to use the Table Exporter App, you can use [`dx extract_dataset`](https://documentation.dnanexus.com/user/helpstrings-of-sdk-command-line-utilities#extract_dataset) which is part of the dx-toolkit. 

1. Extract data dictionary/codings files using the `-ddd` (Dump Dataset Dictionary) option.
2. Join data dictionary and coding file together
3. Define a new column consisting of entity + field name
4. Scan fields of interest in combined file
5. Make a comma delimited list of field titles to use 


- `-ddd`
- `--delim` [DELIMTER]
- `--sql` 
- `-o` [OUTPUT FILE]


```{bash}

```

## Decoding Your Dataset

